<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <title>GH Scrum Board</title>
  <link rel='stylesheet' href='/bower_components/foundation/css/normalize.min.css'>
  <link rel='stylesheet' href='/bower_components/foundation/css/foundation.min.css'>
  <link rel='stylesheet' href='css/style.css'>
</head>
<body>
<!-- <div id='tabs'>
	<ul id='ul-tabs' class='tabs vertical' data-tab>
		<li class='tab-title'>
			<a href='#dashbaord'>Dashboard</a>
		</li>
	</ul>
	<div id='tabs-content' class='tabs-content'>
		<div id='dashboard' class='content active'>
			<div class='row'>
				<div class='columns small-12'>
					<h2>Dashboard</h2>
				</div>
			</div>
			<div class='row'>
				<div class='columns small-12'>Here be the info.</div>
			</div>
		</div>
	</div>
</div> -->

<div id='scrumboard'></div>
<pre style='word-wrap: break-word;'></pre>

<script src='/bower_components/underscore/underscore-min.js' type='text/javascript'></script>
<script src='/bower_components/jquery/dist/jquery.min.js' type='text/javascript'></script>
<script src='/bower_components/jquery-ui/jquery-ui.min.js' type='text/javascript'></script>
<script src='/bower_components/backbone/backbone-min.js' type='text/javascript'></script>
<script src='/bower_components/backbone.babysitter/lib/backbone.babysitter.min.js' type='text/javascript'></script>
<script src='/bower_components/backbone.wreqr/lib/backbone.wreqr.min.js' type='text/javascript'></script>
<script src='/bower_components/marionette/lib/backbone.marionette.min.js' type='text/javascript'></script>
<script src='/bower_components/foundation/js/foundation.min.js'></script>
<script src='/bower_components/matchHeight/jquery.matchHeight-min.js'></script>

<!-- Helper Functions -->
<script src='js/utilities.js' type='text/javascript'></script>
<!-- Models -->
<script src='js/models.js' type='text/javascript'></script>
<!-- Collections -->
<script src='js/collections.js' type='text/javascript'></script>
<!-- Views -->
<script src='js/views.js' type='text/javascript'></script>
<!-- Main App Controller Logic -->
<script src='js/app.js' type='text/javascript'></script>




<script>
	// I don't know backbone very well, but it annoys me that most of the functionality is in the view
	// rather than split between the controller and model. I'm not sure if this happens often with
	// backbone, but this seems to be what I'm doing. Bad or normal?
	//
	// Also, right now, I'm binding some events (here just logging so far because the write integration
	// to Github hasn't been implemented in the backend) via jQuery in the sortable widget. I might
	// try to see if I can do this in Backbone instead, if that is possible.
	//
	// We also need to add polling to the app so that it will receive updates from GH itself. I can
	// do this either via circuiting it through the backend or via GH itself. It would be easier to
	// make sure there was no read/write conflict or mismatch if it's all circuited through the
	// backend.
	//
	// @todo add in boards via milestones
	// @todo re-add in board selection
	// @todo reduce the number of tags needed to make it function
	// @todo use closed state
	// @todo add in icebox
	// @todo add ability to choose repo
	// @todo add in app authentication with github
	// @todo add in polling to Github for server
	// @todo add in polling to server from app
	// @todo add in Backbone events to update the views upon receiving new data


	////////
	//////// Start the 'app' and make it work
	////////

	// So, I think that I'm cheating by making everything wait for sort of all-encompassing promise
	// to resolve, but the data wasn't rendering correctly because it was executing faster than
	// the data could populate, so... am I cheating? Probably. It's good enough for a first run.
	var appPromise = app.init();
	appPromise.done(function() {
		// This will render the board and the columns on the board.
	  var columns = new AllColumnsView({ el: $('#scrumboard'), collection: app.columns });
	  columns.render();

	  // This will render the tasks in the columns
		var issueView = new AllTasksView({ collection: app.tasks });
		issueView.render();

		// Make everything sortable.
	  $( '.sortable' ).sortable({
	  	connectWith: '.sortable',
	  	tolerance: 100,
	  	snap: true,
	  	revert: 50,
	  	opacity: 0.85,
	  	helper: 'hover',
	  	forcePlaceholderSize: true,
	  	cursorAt: { left: 5, top: 5 },
	  	appendTo: 'body',
			helper: 'clone',
	    placeholder: 'ui-state-highlight',
	    change: function(event, ui) {
	    	// Resize all the columns to make sure that they still match in size
	    	$('.scrum-column').matchHeight();
	    },
	    remove: function(event, ui) {
	    	// We need to send a call to remove the old state tag
	    	console.log('EVENT: Remove tag: ' + this.id.substr(0, this.id.length - 8) + ' from ' + event.toElement.id);
	    },
	    receive: function(event, ui) {
	    	// We need to send a call to add the new state tag
	    	console.log('EVENT: Add tag: ' + this.id.substr(0, this.id.length - 8) + ' from ' + event.toElement.id);
	    	$('.scrum-column').matchHeight();
	    }
	  });
	  $('.scrum-column').matchHeight();
	  $('.select-assignee').change(function (event, ui) {
	  	var taskID = $($(this).parent().parent().parent())[0]['id']
	  	var newAssignee = this.value;
	  	if (newAssignee == '') {
	  		newAssignee = 'null';
	  	}
	  	console.log('EVENT: Assign task ' + taskID + ' to ' + newAssignee);
	  });
	});
	// Apply foundation to make everything work better, please.
  $(document).foundation();
</script>
</body>
</html>


