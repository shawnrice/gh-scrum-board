<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <title>GH Scrum Board</title>
  <link rel='stylesheet' href='/bower_components/foundation/css/normalize.min.css'>
  <link rel='stylesheet' href='/bower_components/foundation/css/foundation.min.css'>
  <link rel='stylesheet' href='css/style.css'>
</head>
<body>
<!-- <div id='tabs'>
	<ul id='ul-tabs' class='tabs vertical' data-tab>
		<li class='tab-title'>
			<a href='#dashbaord'>Dashboard</a>
		</li>
	</ul>
	<div id='tabs-content' class='tabs-content'>
		<div id='dashboard' class='content active'>
			<div class='row'>
				<div class='columns small-12'>
					<h2>Dashboard</h2>
				</div>
			</div>
			<div class='row'>
				<div class='columns small-12'>Here be the info.</div>
			</div>
		</div>
	</div>
</div> -->

<div id='scrumboard'></div>
<pre style='word-wrap: break-word;'></pre>

<script src='/bower_components/underscore/underscore-min.js' type='text/javascript'></script>
<script src='/bower_components/jquery/dist/jquery.min.js' type='text/javascript'></script>
<script src='/bower_components/jquery-ui/jquery-ui.min.js' type='text/javascript'></script>
<script src='/bower_components/backbone/backbone-min.js' type='text/javascript'></script>
<script src='/bower_components/backbone.babysitter/lib/backbone.babysitter.min.js' type='text/javascript'></script>
<script src='/bower_components/backbone.wreqr/lib/backbone.wreqr.min.js' type='text/javascript'></script>
<script src='/bower_components/marionette/lib/backbone.marionette.min.js' type='text/javascript'></script>
<script src='/bower_components/foundation/js/foundation.min.js'></script>
<script src='/bower_components/matchHeight/jquery.matchHeight-min.js'></script>

<!-- Helper Functions -->
<script src='js/utilities.js' type='text/javascript'></script>
<!-- Models -->
<script src='js/models.js' type='text/javascript'></script>
<!-- Collections -->
<script src='js/collections.js' type='text/javascript'></script>
<!-- Views -->
<script src='js/views.js' type='text/javascript'></script>
<!-- Main App Controller Logic -->
<script src='js/app.js' type='text/javascript'></script>




<script>
	// I don't know backbone very well, but it annoys me that most of the functionality is in the view
	// rather than split between the controller and model. I'm not sure if this happens often with
	// backbone, but this seems to be what I'm doing. Bad or normal?

	////////
	//////// Start the 'app' and make it work
	////////

	// So, I think that I'm cheating by making everything wait for sort of all-encompassing promise
	// to resolve, but the data wasn't rendering correctly because it was executing faster than
	// the data could populate, so... am I cheating? Probably. It's good enough for a first run.
	var appPromise = app.init();
	appPromise.done(function() {
		// This will render the board and the columns on the board.
	  var columns = new AllColumnsView({ el: $('#scrumboard'), collection: app.columns });
	  columns.render();

	  // This will render the tasks in the columns
		var issueView = new AllTasksView({ collection: app.tasks });
		issueView.render();

		// Make everything sortable.
	  $( '.sortable' ).sortable({
	  	connectWith: '.sortable',
	  	tolerance: 100,
	  	snap: true,
	  	revert: 50,
	  	opacity: 0.85,
	  	helper: 'hover',
	  	forcePlaceholderSize: true,
	  	cursorAt: { left: 5, top: 5 },
	  	appendTo: 'body',
			helper: 'clone',
	    placeholder: 'ui-state-highlight',
	    change: function(event, ui) {
	    	// Resize all the columns to make sure that they still match in size
	    	$('.scrum-column').matchHeight();
	    },
	    remove: function(event, ui) {
	    	// We need to send a call to remove the old state tag
	    	var state = $(this).context['id'];
	    	console.log('Remove tag: ' + state.substr(0, state.length - 8));
	    },
	    receive: function(event, ui) {
	    	// We need to send a call to add the new state tag
	    	var state = $(this).context['id'];
	    	console.log('Add tag: ' + state.substr(0, state.length - 8));
	    }
	  });
	  $('.scrum-column').matchHeight();
	});
	// Apply foundation to make everything work better, please.
  $(document).foundation();
</script>
</body>
</html>


